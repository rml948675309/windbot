name: Build KewlTune WindBot

on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install .NET Framework 4.0 Targeting Pack
      shell: powershell
      run: |
        Write-Host "Downloading .NET Framework 4.0 Developer Pack..."
        $url = "https://download.microsoft.com/download/9/5/A/95A9616B-7A37-4AF6-BC36-D6EA96C8DAAE/dotNetFx40_Full_x86_x64.exe"
        $installer = "$env:TEMP\dotnetfx40.exe"
        Invoke-WebRequest -Uri $url -OutFile $installer
        Write-Host "Installing..."
        Start-Process -FilePath $installer -ArgumentList "/q","/norestart" -Wait
        Write-Host "Done!"
      
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2
      
    - name: Setup NuGet
      uses: nuget/setup-nuget@v2
        
    - name: Restore NuGet packages
      run: nuget restore WindBot.sln
      
    - name: Build only Windows projects (skip Android)
      run: msbuild WindBot.sln /p:Configuration=Release /p:Platform="Any CPU" /t:WindBot;ExecutorBase
      
    - name: Find build outputs
      run: |
        echo "=== Build outputs found ==="
        Get-ChildItem -Path . -Include *.dll,*.exe -Recurse | Where-Object { $_.FullName -like "*\bin\Release\*" -or $_.FullName -like "*\out\*\bin\*\Release\*" }
      
    - name: Upload compiled files
      uses: actions/upload-artifact@v4
      with:
        name: KewlTune-WindBot-DLLs
        path: |
          **/bin/Release/*.dll
          **/bin/Release/*.exe
          **/bin/Release/*.pdb
          **/out/**/bin/**/Release/*.dll
          **/out/**/bin/**/Release/*.exe
